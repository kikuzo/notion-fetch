# notion-fetch

## これはなに？

[Notion](https://www.notion.so)のAPIを叩いて、データベースをfetch(query)しそこに含まれるページ情報を取得するサンプルコードです。取得したページ情報を、[Pixe.la](https://pixe.la/ja)とSlackに書き出すサンプルコードもついてます。

Notionでのページ作成頻度をPixe.laに記録する、という使い方を想定しています。
AWS Lambda環境で実行することを想定していますが、手元のマシン(Mac)等でも動きます。

## 使い方

### 事前準備
Notion APIを利用するための、Notionのアクセストークン、ターゲットとなるデータベースのID、ページをユーザIDでフィルタする場合にはユーザIDを、それぞれ用意し、それをソースコードの6,7,8行目にセットして下さい。

Pixe.laに書き出す場合には、Pixe.laのターゲットとなるグラフのURL、アクセストークンを用意し、それをソースコードの10,11行目にセットして下さい。

Slackに書き出す場合には、SlackのWebhook URLとターゲットチャネルを用意して、13,14行目にセットします。


### 実際の使い方
AWS Lambdaで使う場合には、85行目からのlambda_handler関数内を適当にコメントアウト、あるいはコメント解除して下さい。
git上のバージョンでは、Notionにアクセスして得られた結果をprintするようになっていますので、ここをコメントアウトして、代わりに90行目もしくは91行目を有効化してください。

コマンドラインで使う場合には、98行目からの行を適当に編集して下さい。


## コードの説明

Notion Database queryでは、フィルタとソート条件を設定できます。このコードでは、ユーザIDと更新日時（今日更新した分）でフィルタし、逆順でソートしています（29行目から54行目）。

得られた結果はnotion_fetch()の返り値としていますが、pixela_pixelpost_today()とsend_message()ではそれぞれ件数しか使っていません。notion_fetch()の返り値としてはdict型で色々なproperty情報(例：ページタイトル)が入っていますので、取り出して使うことは可能です。



